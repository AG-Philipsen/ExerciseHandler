%__BEGIN_PACKAGES__%
\usepackage{xifthen}
\usepackage{xargs}
%__END_PACKAGES__%


%__BEGIN_DEFINITIONS__%
\newlength{\myskip}
\setlength{\myskip}{6mm plus 1mm minus 1mm}
%Options for Presence Sheet
\newcommand{\myEveryEvenRowColor}{\rowcolor[gray]{0.92}}
\newboolean{switchOffSignatureColumn}
\setboolean{switchOffSignatureColumn}{false}
\newboolean{switchOffExerciseColumn}
\setboolean{switchOffExerciseColumn}{false}

\newcommand{\PrintTutorList}{
    \newboolean{printTutor}                 % xifthen package
    \setboolean{printTutor}{true}           % xifthen package
    \newcounter{Tutor}
    \whiledo{\boolean{printTutor}}{         % xifthen package
        \refstepcounter{Tutor}
        \checkTutor(\theTutor)              % arrayjob package
        \ifemptydata                        % arrayjob package
            \setboolean{printTutor}{false}  % xifthen package
        \else
            \centerline{
                \textsc{\Tutor(\theTutor):}
                \texttt{\TutorMail(\theTutor)}
            }
        \fi
    }
}

\newcommand{\Heading}[1][true]{
    \newboolean{printTutorList}             % xifthen package
    \setboolean{printTutorList}{#1}         % xifthen package
    \centerline{\Large\scshape\lecture}%
    \vskip 2pt%
    \centerline{\scshape\semester~--~\professor}%
    \vskip 3pt%
    \hrule%
    \vskip 5pt%
    \ifthenelse{\boolean{printTutorList}}{%
        \PrintTutorList%
    }{}
    \vspace{\myskip}
}

\newcommandx{\Sheet}[3][1=Exercise sheet, 2=, 3=, usedefault]{
    \ifthenelse{\isempty{#2}}{
        \centerline{\Large\textbf{#1}}
    }{
        \centerline{\Large\textbf{#1 #2}}
    }
    % Print subtitle only for exercises, not for solutions
    \ifthenelse{\equal{#1}{Exercise sheet}}{
        % Here we have to print as subtitle a string which is the concatenation
        % of \exerciseSheetSubtitlePrefix and #2, which could be empty or not in
        % all the possible combinations. So test them.
        \ifthenelse{\isempty{\exerciseSheetSubtitlePrefix}}{
            \ifthenelse{\isempty{#3}}{}{
                \centerline{\textit{#3}}
            }
        }{
            \ifthenelse{\isempty{#3}}{
                \centerline{\textit{\exerciseSheetSubtitlePrefix}}
            }{
                \centerline{\textit{\exerciseSheetSubtitlePrefix{} #3}}
            }
        }
    }{}
    % Print current date as subtitle only for presence sheet
    \ifthenelse{\equal{#1}{Presence sheet}}{
        \centerline{\today{}}
    }{}
    \vspace{2\myskip}
}

\newcommand{\ExamCoverPage}[1]{%
    \begingroup
        \large
        \noindent\textbf{Duration:} \examDuration  \hfill \textbf{\examDate}
        \par% https://tex.stackexchange.com/a/91539
    \endgroup
    \vfill%
    \examRules%
    \vfill%
    \begingroup
        \large
        \centering
        \begin{tabular}{rp{0.6\textwidth}}
            Name:       & \underline{\hspace{0.6\textwidth}} \\[3ex]
            ID number:  & \underline{\hspace{0.6\textwidth}} \\[5ex]
        \end{tabular}
        \setlength{\aboverulesep}{0pt}
        \setlength{\belowrulesep}{0pt}
        \renewcommand{\arraystretch}{1.8}
        \newcolumntype{?}{!{\vrule width \heavyrulewidth}}
        \pgfmathsetmacro{\numberOfExercises}{#1}
        \pgfplotstableset{columns/Ex/.style={int detect,column type=?c|,column name=\textsc{Exercise}}}
        \pgfplotstableset{columns/Score/.style={string type,column type=c?,column name=\textsc{Score}}}
        \pgfplotstableset{create on use/Ex/.style={create col/set list={1,...,\numberOfExercises}}}
        \pgfplotstableset{create on use/Score/.style={}}
        \pgfplotstablenew[columns={Ex,Score}]{\numberOfExercises}\loadedtable
        \pgfplotstabletypeset[every head row/.style={before row=\toprule, after row=\midrule},
                              every even row/.style={before row={\rowcolor[gray]{0.9}}},
                              every last row/.style={after row=\midrule \textsc{Total} & \\ \bottomrule}]\loadedtable
        \vspace{2\myskip}
        \begin{tabular}{rp{10cm}}
            Final mark:       & \underline{\hspace{9cm}} \\[3ex]
        \end{tabular}

    \par% https://tex.stackexchange.com/a/91539
    \endgroup
    \vfill
    \newpage%
}

\newcounter{Exercise}
\newenvironment{exercise}[1][optional]
{
    \refstepcounter{Exercise}
    \ifthenelse{\isempty{#1}}{
        \noindent{\large\textbf{Exercise \theExercise}}\\[0.75ex]
    }{
        \noindent{\large\textbf{Exercise \theExercise}} $\;$[\textit{#1}]\\[0.75ex]
    }
}
{\par\vspace{\myskip}}

\newcounter{Solution}
\newenvironment{solution}[1][optional]
{
    \refstepcounter{Solution}
    \ifthenelse{\isempty{#1}}{
        \noindent{\large\textbf{Exercise \theSolution}}\\[0.75ex]
    }{
        \noindent{\large\textbf{Exercise \theSolution}} $\;$[\textit{#1}]\\[0.75ex]
    }
}
{\par\vspace{\myskip}}


%__END_DEFINITIONS__%
